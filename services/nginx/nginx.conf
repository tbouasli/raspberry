events {
    worker_connections 1024;
}

stream {
    log_format stream_format '$remote_addr [$time_local] '
                             '$protocol $status $bytes_sent $bytes_received '
                             '$session_time "$upstream_addr" '
                             '"$upstream_bytes_sent" "$upstream_bytes_received" "$upstream_connect_time"';

    access_log /var/log/nginx/stream_access.log stream_format;
    error_log /var/log/nginx/stream_error.log;

    upstream minecraft_backend {
        server minecraft:25565;
    }

    server {
        listen 25565;
        proxy_pass minecraft_backend;
        proxy_timeout 1s;
        proxy_responses 1;
    }
}

http {
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    server {
        listen 80;
        server_name _;

        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }

        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }

        location / {
            return 200 '<!DOCTYPE html>
<html>
<head>
    <title>Minecraft Server</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        h1 { color: #4CAF50; }
        .server-info { background: #f0f0f0; padding: 20px; margin: 20px; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>ðŸŽ® Minecraft Server</h1>
    <div class="server-info">
        <h2>Server Information</h2>
        <p><strong>Address:</strong> minecraft.bouasli.com:25565</p>
        <p><strong>Status:</strong> Online</p>
        <p><strong>Version:</strong> 1.21.8</p>
    </div>
</body>
</html>';
            add_header Content-Type text/html;
        }
    }

}
